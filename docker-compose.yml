version: '3'
services:
  osaka-db:
    image: ekayim/dejima-postgres:latest
    container_name: Osaka-db
    ports:
        - 54321:5432
    volumes:
        - ./db/postgresql.conf:/etc/postgresql.conf
        - ./db/initialize.sh:/docker-entrypoint-initdb.d/initialize.sh
        - ./db/setup_files:/etc/setup_files
    environment:
        - PEER_NAME=Osaka # Replace with your university (Osaka/ Kyoto/ Hosei)

  osaka-proxy:
    build: ./proxy
    container_name: Osaka-proxy
    command: python3 server.py
    volumes:
        - ./proxy:/code
    ports:
        - 8001:8000
    depends_on:
        - osaka-db
    environment: 
        - PEER_NAME=Osaka # Replace with your university (Osaka/ Kyoto/ Hosei)

  kyoto-db:
    image: ekayim/dejima-postgres:latest
    container_name: Kyoto-db
    ports:
        - 54322:5432
    volumes:
        - ./db/postgresql.conf:/etc/postgresql.conf
        - ./db/initialize.sh:/docker-entrypoint-initdb.d/initialize.sh
        - ./db/setup_files:/etc/setup_files
    environment:
        - PEER_NAME=Kyoto # Replace with your university (Osaka/ Kyoto/ Hosei)

  kyoto-proxy:
    build: ./proxy
    container_name: Kyoto-proxy
    command: python3 server.py
    volumes:
        - ./proxy:/code
    ports:
        - 8002:8000
    depends_on:
        - kyoto-db
    environment: 
        - PEER_NAME=Kyoto # Replace with your university (Osaka/ Kyoto/ Hosei)

  hosei-db:
    image: ekayim/dejima-postgres:latest
    container_name: Hosei-db
    ports:
        - 54323:5432
    volumes:
        - ./db/postgresql.conf:/etc/postgresql.conf
        - ./db/initialize.sh:/docker-entrypoint-initdb.d/initialize.sh
        - ./db/setup_files:/etc/setup_files
    environment:
        - PEER_NAME=Hosei # Replace with your university (Osaka/ Kyoto/ Hosei)

  hosei-proxy:
    build: ./proxy
    container_name: Hosei-proxy
    command: python3 server.py
    volumes:
        - ./proxy:/code
    ports:
        - 8003:8000
    depends_on:
        - hosei-db
    environment: 
        - PEER_NAME=Hosei # Replace with your university (Osaka/ Kyoto/ Hosei)